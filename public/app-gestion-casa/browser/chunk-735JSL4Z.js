import{a as j,b as J,c as Y}from"./chunk-R6RK33SS.js";import{B as _,D as u,E as y,F as E,G as n,H as t,J as S,K as I,L as x,O as w,P as a,Q as v,R as h,S as D,U as p,V as R,X as g,Y as T,_ as b,a as B,aa as A,b as F,ba as U,ca as V,da as $,fa as G,o as M,p as O,t as N,u as r,w as P,x as z}from"./chunk-YYEMXXJX.js";function q(o,i){if(o&1){let e=S();n(0,"div",8),I("click",function(){let s=M(e).$implicit,m=x(3);return O(m.selectMonth(s.month,s.year))}),n(1,"h3"),a(2),t(),n(3,"div",9)(4,"div",10)(5,"span",11),a(6,"Ingresos:"),t(),n(7,"span",12),a(8),p(9,"currency"),t()(),n(10,"div",13)(11,"span",11),a(12,"Gastos:"),t(),n(13,"span",14),a(14),p(15,"currency"),t()(),n(16,"div",15)(17,"span",11),a(18,"Balance:"),t(),n(19,"span",16),a(20),p(21,"currency"),t()()()()}if(o&2){let e=i.$implicit;r(2),v(e.label),r(6),h(" ",g(9,8,e.totalIncome,"EUR","symbol","1.2-2")," "),r(6),h(" ",g(15,13,e.totalExpenses,"EUR","symbol","1.2-2")," "),r(2),y("positive",e.balance>=0)("negative",e.balance<0),r(4),h(" ",g(21,18,e.balance,"EUR","symbol","1.2-2")," ")}}function K(o,i){if(o&1&&(n(0,"div",6),_(1,q,22,23,"div",7),t()),o&2){let e=x(2);r(),u("ngForOf",e.availableMonths())}}function Q(o,i){o&1&&(n(0,"div",17)(1,"h2"),a(2,"No hay historial disponible"),t(),n(3,"p"),a(4,"Agrega algunas transacciones para ver tu historial mensual"),t(),n(5,"a",18),a(6,"Ir a Transacciones"),t()())}function W(o,i){if(o&1&&(n(0,"div"),_(1,K,2,1,"div",5)(2,Q,7,0,"ng-template",null,1,T),t()),o&2){let e=w(3),l=x();r(),u("ngIf",l.availableMonths().length>0)("ngIfElse",e)}}function X(o,i){if(o&1&&(n(0,"div",35)(1,"div",36)(2,"div",37),a(3),t(),n(4,"div",38)(5,"span",39),a(6),t(),n(7,"span",40),a(8),p(9,"date"),t()()(),n(10,"div",41)(11,"span"),a(12),p(13,"currency"),t()()()),o&2){let e=i.$implicit;y("income",e.type==="income")("expense",e.type==="expense"),r(3),v(e.description),r(3),v(e.category),r(2),h(" ",e.date?R(9,11,e.date,"dd/MM/yyyy"):"Sin fecha"," "),r(3),E(e.type==="income"?"text-success":"text-danger"),r(),D(" ",e.type==="income"?"+":"-","",g(13,14,e.amount,"EUR","symbol","1.2-2")," ")}}function Z(o,i){if(o&1&&(n(0,"div",33)(1,"h3"),a(2),t(),_(3,X,14,19,"div",34),t()),o&2){let e=x().ngIf;r(2),h("Transacciones (",e.transactions.length,")"),r(),u("ngForOf",e.transactions)}}function ee(o,i){if(o&1){let e=S();n(0,"div",20)(1,"div",21)(2,"button",22),I("click",function(){M(e);let s=x(2);return O(s.clearSelection())}),a(3,"\u2190 Volver al Historial"),t(),n(4,"h2"),a(5),t()(),n(6,"div",23)(7,"div",24)(8,"div",25),a(9,"\u{1F4B0}"),t(),n(10,"div",26)(11,"h3"),a(12,"Ingresos Totales"),t(),n(13,"p",27),a(14),p(15,"currency"),t()()(),n(16,"div",28)(17,"div",25),a(18,"\u{1F4B8}"),t(),n(19,"div",26)(20,"h3"),a(21,"Gastos Totales"),t(),n(22,"p",29),a(23),p(24,"currency"),t()()(),n(25,"div",30)(26,"div",25),a(27,"\u{1F4CA}"),t(),n(28,"div",26)(29,"h3"),a(30,"Balance Final"),t(),n(31,"p",31),a(32),p(33,"currency"),t()()()(),_(34,Z,4,2,"div",32),t()}if(o&2){let e=i.ngIf;r(5),D("",e.month," ",e.year,""),r(9),v(g(15,12,e.totalIncome,"EUR","symbol","1.2-2")),r(9),v(g(24,17,e.totalExpenses,"EUR","symbol","1.2-2")),r(2),y("positive",e.balance>=0)("negative",e.balance<0),r(6),E(e.balance>=0?"text-success":"text-danger"),r(),h(" ",g(33,22,e.balance,"EUR","symbol","1.2-2")," "),r(2),u("ngIf",e.transactions.length>0)}}function te(o,i){if(o&1&&_(0,ee,35,27,"div",19),o&2){let e=x();u("ngIf",e.selectedMonthData())}}var L=class o{constructor(i,e){this.ingresoService=i;this.gastoService=e}selectedMonth=N(null);allTransactions=b(()=>[...this.ingresoService.ingresos(),...this.gastoService.gastos()].map(i=>F(B({},i),{date:i.date??new Date(i.fecha)})).sort((i,e)=>new Date(e.date).getTime()-new Date(i.date).getTime()));availableMonths=b(()=>{let i=this.allTransactions(),e=new Map;i.forEach(s=>{let m=new Date(s.date),c=`${m.getFullYear()}-${m.getMonth()}`;e.has(c)||e.set(c,[]),e.get(c).push(s)});let l=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];return Array.from(e.entries()).map(([s,m])=>{let[c,d]=s.split("-").map(Number),k=m.filter(f=>f.type==="income").reduce((f,C)=>f+C.amount,0),H=m.filter(f=>f.type==="expense").reduce((f,C)=>f+C.amount,0);return{month:d,year:c,label:`${l[d]} ${c}`,totalIncome:k,totalExpenses:H,balance:k-H}}).sort((s,m)=>m.year-s.year||m.month-s.month)});selectedMonthData=b(()=>{let i=this.selectedMonth();if(!i)return null;let e=this.allTransactions().filter(c=>{let d=new Date(c.date);return d.getMonth()===i.month&&d.getFullYear()===i.year}),l=e.filter(c=>c.type==="income").reduce((c,d)=>c+d.amount,0),s=e.filter(c=>c.type==="expense").reduce((c,d)=>c+d.amount,0);return{month:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][i.month],year:i.year,totalIncome:l,totalExpenses:s,balance:l-s,transactions:e}});selectMonth(i,e){this.selectedMonth.set({month:i,year:e})}clearSelection(){this.selectedMonth.set(null)}static \u0275fac=function(e){return new(e||o)(P(J),P(Y))};static \u0275cmp=z({type:o,selectors:[["app-history"]],decls:10,vars:2,consts:[["monthDetails",""],["noHistory",""],[1,"history"],[1,"history-header"],[4,"ngIf","ngIfElse"],["class","months-grid",4,"ngIf","ngIfElse"],[1,"months-grid"],["class","month-card",3,"click",4,"ngFor","ngForOf"],[1,"month-card",3,"click"],[1,"month-summary"],[1,"summary-item","income"],[1,"label"],[1,"value","text-success"],[1,"summary-item","expense"],[1,"value","text-danger"],[1,"summary-item","balance"],[1,"value"],[1,"no-history"],["routerLink","/transactions",1,"btn","btn-primary"],["class","month-details",4,"ngIf"],[1,"month-details"],[1,"details-header"],[1,"btn","btn-primary",3,"click"],[1,"month-stats"],[1,"stat-card","income"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value","text-success"],[1,"stat-card","expense"],[1,"stat-value","text-danger"],[1,"stat-card","balance"],[1,"stat-value"],["class","month-transactions",4,"ngIf"],[1,"month-transactions"],["class","transaction-item",3,"income","expense",4,"ngFor","ngForOf"],[1,"transaction-item"],[1,"transaction-info"],[1,"transaction-description"],[1,"transaction-meta"],[1,"transaction-category"],[1,"transaction-date"],[1,"transaction-amount"]],template:function(e,l){if(e&1&&(n(0,"app-layout")(1,"div",2)(2,"div",3)(3,"h1"),a(4,"Historial Mensual"),t(),n(5,"p"),a(6,"Revisa tus ingresos y gastos mes a mes"),t()(),_(7,W,4,2,"div",4)(8,te,1,1,"ng-template",null,0,T),t()()),e&2){let s=w(9);r(7),u("ngIf",!l.selectedMonthData())("ngIfElse",s)}},dependencies:[G,A,U,$,V,j],styles:[".history[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.history-header[_ngcontent-%COMP%]{margin-bottom:2rem}.history-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:#1f2937;margin-bottom:.5rem}.history-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280}.months-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}.month-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:1rem;box-shadow:0 4px 6px -1px #0000001a;cursor:pointer;transition:all .3s ease;border:2px solid transparent}.month-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 25px -5px #00000026;border-color:#2563eb}.month-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#1f2937;font-size:1.25rem;margin-bottom:1.5rem;text-align:center;font-weight:600}.month-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;border-radius:.5rem;background:#f9fafb}.summary-item.balance.positive[_ngcontent-%COMP%]{background:#f0fdf4}.summary-item.balance.negative[_ngcontent-%COMP%]{background:#fef2f2}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#374151}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600}.no-history[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background:#fff;border-radius:1rem;box-shadow:0 4px 6px -1px #0000001a}.no-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#6b7280;margin-bottom:1rem}.no-history[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;margin-bottom:2rem}.month-details[_ngcontent-%COMP%]{background:#fff;border-radius:1rem;padding:2rem;box-shadow:0 4px 6px -1px #0000001a}.details-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1f2937;margin:0;flex:1}.month-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.5rem;border-radius:.75rem;background:#f9fafb}.stat-card.income[_ngcontent-%COMP%]{border-left:4px solid #16a34a}.stat-card.expense[_ngcontent-%COMP%]{border-left:4px solid #dc2626}.stat-card.balance.positive[_ngcontent-%COMP%]{border-left:4px solid #16a34a}.stat-card.balance.negative[_ngcontent-%COMP%]{border-left:4px solid #dc2626}.stat-icon[_ngcontent-%COMP%]{font-size:2rem;opacity:.8}.stat-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;font-weight:500;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.025em}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0}.month-transactions[_ngcontent-%COMP%]{border-top:1px solid #e5e7eb;padding-top:2rem}.month-transactions[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#1f2937;margin-bottom:1.5rem}.transaction-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-radius:.5rem;background:#f9fafb;margin-bottom:.75rem;border-left:4px solid transparent;transition:all .2s ease}.transaction-item[_ngcontent-%COMP%]:hover{background:#f3f4f6}.transaction-item.income[_ngcontent-%COMP%]{border-left-color:#16a34a}.transaction-item.expense[_ngcontent-%COMP%]{border-left-color:#dc2626}.transaction-info[_ngcontent-%COMP%]{flex:1}.transaction-description[_ngcontent-%COMP%]{font-weight:500;color:#1f2937;margin-bottom:.25rem}.transaction-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.transaction-category[_ngcontent-%COMP%]{background:#e5e7eb;color:#374151;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;font-weight:500}.transaction-date[_ngcontent-%COMP%]{font-size:.75rem;color:#9ca3af}.transaction-amount[_ngcontent-%COMP%]{font-weight:600;font-size:1.125rem}@media (max-width: 768px){.months-grid[_ngcontent-%COMP%], .month-stats[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.transaction-item[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:.75rem}.transaction-amount[_ngcontent-%COMP%]{text-align:right}.transaction-meta[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})};export{L as HistoryComponent};
